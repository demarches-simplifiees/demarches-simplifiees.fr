- if dossier.en_construction? || dossier.en_instruction?
  %span.button.primary.dropdown
    = dossier.decorate.display_state
    .dropdown-content.fade-in-down
      %ul.dropdown-items
        - if dossier.en_construction?
          %li.selected
            .icon.edit
            .description
              %h4 En construction
              Vous permettez à l'usager de modifier ses réponses au formulaire
          %li
            = link_to backoffice_dossier_receive_path(dossier, new_ui: true), method: :post, data: { confirm: "Confirmer vous le passage en instruction de ce dossier ?" } do
              .icon.in-progress
              .description
                %h4 Passer en instruction
                L'usager ne pourra plus modifier le formulaire

        - if dossier.en_instruction?
          %li
            = link_to backoffice_dossier_reopen_path(dossier, new_ui: true), method: :post, data: { confirm: "Confirmer vous la réouverture de ce dossier ?" } do
              .icon.edit
              .description
                %h4 Repasser en construction
                Vous permettrez à l'usager de modifier ses réponses au formulaire
          %li.selected
            .icon.in-progress
            .description
              %h4 En instruction
              L'usager ne peut modifier son dossier pendant l'instruction
          %li{ onclick: "TPS.showMotivation('accept');" }
            .icon.accept
            .description
              %h4 Accepter
              L'usager sera notifié que son dossier a été accepté
          %li{ onclick: "TPS.showMotivation('without-continuation');" }
            .icon.without-continuation
            .description
              %h4 Classer sans suite
              L'usager ne recevra aucune notification
          %li{ onclick: "TPS.showMotivation('close');" }
            .icon.close
            .description
              %h4 Refuser
              L'usager sera notifié que son dossier a été refusé
      = render partial: 'new_gestionnaire/dossiers/state_button_motivation', locals: { dossier: dossier, popup_title: 'Accepter le dossier',  popup_class: 'accept', process_action: 'close', title: 'Accepter', confirm: 'Accepter ce dossier ?' }
      = render partial: 'new_gestionnaire/dossiers/state_button_motivation', locals: { dossier: dossier, popup_title: 'Classer le dossier sans suite', popup_class: 'without-continuation', process_action: 'without_continuation', title: 'Classer sans suite', confirm: 'Confirmer vous le classement sans suite de ce dossier ?' }
      = render partial: 'new_gestionnaire/dossiers/state_button_motivation', locals: { dossier: dossier, popup_title: 'Refuser le dossier', popup_class: 'close', process_action: 'refuse', title: 'Refuser', confirm: 'Confirmer vous le refus de ce dossier ?' }

- else
  - if dossier.motivation.present? || dossier.attestation.present?
    %span.button.dropdown{ class: button_or_label_class(dossier) }
      = dossier.statut
      .dropdown-content.fade-in-down.terminated
        - if dossier.motivation.present?
          %h4 Motivation
          %p.dossier-motivation= dossier.motivation

        - if dossier.attestation.present?
          %h4 Attestation
          %p.attestation L'acceptation du dossier a envoyé automatiquement une attestation au demandeur
          = link_to "Voir l'attestation", attestation_dossier_path(dossier.procedure, dossier), target: '_blank', class: 'button'
  - else
    %span.label{ class: button_or_label_class(dossier) }
      = dossier.statut
