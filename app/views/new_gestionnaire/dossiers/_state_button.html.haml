- if dossier.en_construction? || dossier.en_instruction?
  %span.button.primary.dropdown
    = dossier.decorate.display_state
    .dropdown-content.fade-in-down
      %ul.dropdown-items
        - if dossier.en_construction?
          %li.selected
            .icon.edit
            .description
              %h4 En construction
              Vous permettez à l'usager de modifier ses réponses au formulaire
          %li
            = link_to backoffice_dossier_receive_path(dossier, new_ui: true), method: :post, data: { confirm: "Confirmer vous le passage en instruction de ce dossier ?" } do
              .icon.in-progress
              .description
                %h4 Passer en instruction
                L'usager ne pourra plus modifier le formulaire

        - if dossier.en_instruction?
          %li
            = link_to backoffice_dossier_reopen_path(dossier, new_ui: true), method: :post, data: { confirm: "Confirmer vous la réouverture de ce dossier ?" } do
              .icon.edit
              .description
                %h4 Repasser en construction
                Vous permettrez à l'usager de modifier ses réponses au formulaire
          %li.selected
            .icon.in-progress
            .description
              %h4 En instruction
              L'usager ne peut modifier son dossier pendant l'instruction
          %li{ onclick: "TPS.acceptDossier();" }
            .icon.accept
            .description
              %h4 Accepter
              L'usager sera notifié que son dossier a été accepté
          %li
            = link_to backoffice_dossier_process_dossier_path(dossier, process_action: "without_continuation", new_ui: true), method: :post, data: { confirm: "Confirmer vous le classement sans suite de ce dossier ?" } do
              .icon.without-continuation
              .description
                %h4 Classer sans suite
                L'usager ne recevra aucune notification
          %li
            = link_to backoffice_dossier_process_dossier_path(dossier, process_action: "refuse", new_ui: true), method: :post, data: { confirm: "Confirmer vous le refus de ce dossier ?" } do
              .icon.close
              .description
                %h4 Refuser
                L'usager sera notifié que son dossier a été refusé
      .motivation
        %h3
          .icon.accept
          Accepter le dossier
          = "nº #{dossier.id}"

        = form_tag(backoffice_dossier_process_dossier_url(dossier.id, new_ui: true), method: :post, class: "form") do
          = text_area :dossier, :motivation, class: "motivation-text-area", placeholder: "Rédigez votre motivation ici (facultative)"
          %p.help
            L'acceptation du dossier envoie automatiquement une attestation à l'usager.
          .text-right
            %span.button{ onclick: "TPS.motivationCancel();" } Annuler
            = button_tag "Valider la décision", name: :process_action, value: "close", class: 'button primary', title: 'Accepter', data: { confirm: "Accepter ce dossier ?" }

- else
  - if dossier.motivation.present? || dossier.attestation.present?
    %span.button.dropdown{ class: button_or_label_class(dossier) }
      = dossier.statut
      .dropdown-content.fade-in-down.terminated
        - if dossier.motivation.present?
          %h4 Motivation
          %p.dossier-motivation= dossier.motivation

        - if dossier.attestation.present?
          %h4 Attestation
          %p.attestation L'acceptation du dossier a envoyé automatiquement une attestation au demandeur
          = link_to "Voir l'attestation", attestation_dossier_path(dossier.procedure, dossier), target: '_blank', class: 'button'
  - else
    %span.label{ class: button_or_label_class(dossier) }
      = dossier.statut
