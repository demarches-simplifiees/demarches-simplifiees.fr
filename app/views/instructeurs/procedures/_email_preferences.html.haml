= render Dsfr::AlertComponent.new(state: :info, size: :sm, extra_class_names: 'fr-mb-3w') do |c|
  - c.with_body do
    %p
      = t('.subtitle')

= form_for instructeur_procedure, url: update_email_notifications_instructeur_procedure_path(procedure), html: { data: { controller: 'enable-submit-if-form-changes', action: 'change->enable-submit-if-form-changes#onFormChange' } } do |form|
  %fieldset.fr-fieldset
    .fr-fieldset__element
      %ul.fr-toggle__list
        %li
          = render Dsfr::ToggleComponent.new(form:,
            target: :instant_email_new_dossier,
            title: t(".instant_email_new_dossier.title"),
            hint: t('.instant_email_new_dossier.notice'),
            extra_class_names: 'fr-toggle--border-bottom')

        %li
          = render Dsfr::ToggleComponent.new(form:,
            target: :instant_email_new_message,
            title: t(".instant_email_new_message.title"),
            hint: t('.instant_email_new_message.notice'),
            extra_class_names: 'fr-toggle--border-bottom')

        %li
          = render Dsfr::ToggleComponent.new(form:,
            target: :instant_email_new_expert_avis,
            title: t(".instant_email_new_expert_avis.title"),
            hint: t('.instant_email_new_expert_avis.notice'),
            extra_class_names: 'fr-toggle--border-bottom')

        %li{ data: { controller: "hide-target" } }
          - instant_email_dossier_expiration = instructeur_procedure.instant_email_dossier_expiration?

          .fr-toggle--border-bottom
            = render Dsfr::ToggleComponent.new(form:,
              target: :instant_email_dossier_expiration,
              title: t(".instant_email_dossier_expiration.title"),
              hint: t('.instant_email_dossier_expiration.notice'),
              extra_class_names: 'fr-toggle',
              opt: { "hide-target_target": "source" })

            .fr-notice.fr-notice--warning.fr-mt-1w{ class: (instant_email_dossier_expiration ? "fr-hidden" : nil), data: { "hide-target_target": "toHide" } }
              .fr-container
                .fr-notice__body
                  %p
                    %span.fr-notice__title.fr-text--sm= t('.warning_notice.title')
                    %span.fr-notice__desc.fr-text--sm= t('.warning_notice.desc_expiration')

        %li{ data: { controller: "hide-target" } }
          - instant_email_dossier_expired = instructeur_procedure.instant_email_dossier_expired?

          .fr-toggle--border-bottom
            = render Dsfr::ToggleComponent.new(form:,
              target: :instant_email_dossier_expired,
              title: t(".instant_email_dossier_expired.title"),
              hint: t('.instant_email_dossier_expired.notice'),
              extra_class_names: 'fr-toggle',
              opt: { "hide-target_target": "source" })

            .fr-notice.fr-notice--warning.fr-mt-1w{ class: (instant_email_dossier_expired ? "fr-hidden" : nil), data: { "hide-target_target": "toHide" } }
              .fr-container
                .fr-notice__body
                  %p
                    %span.fr-notice__title.fr-text--sm= t('.warning_notice.title')
                    %span.fr-notice__desc.fr-text--sm= t('.warning_notice.desc_expired')

        %li
          = render Dsfr::ToggleComponent.new(form:,
            target: :instant_email_dossier_deletion,
            title: t(".instant_email_dossier_deletion.title"),
            hint: t('.instant_email_dossier_deletion.notice'),
            extra_class_names: 'fr-toggle--border-bottom')

        %li
          = render Dsfr::ToggleComponent.new(form:,
            target: :daily_email_summary,
            title: t(".daily_email_summary.title"),
            hint: t('.daily_email_summary.notice'),
            extra_class_names: 'fr-toggle--border-bottom')

        %li
          = render Dsfr::ToggleComponent.new(form:,
            target: :weekly_email_summary,
            title: t(".weekly_email_summary.title"),
            hint: t('.weekly_email_summary.notice'),
            extra_class_names: 'fr-toggle--border-bottom')

  %ul.fr-btns-group.fr-btns-group--inline
    %li= link_to t('instructeurs.procedures.notification_preferences.buttons.cancel'), instructeur_procedure_path(procedure), class: 'fr-btn fr-btn--secondary fr-mr-2w'
    %li= form.submit t('instructeurs.procedures.notification_preferences.buttons.save'), class: "fr-btn", data: { 'enable-submit-if-form-changes-target': 'submitButton' }, disabled: true
