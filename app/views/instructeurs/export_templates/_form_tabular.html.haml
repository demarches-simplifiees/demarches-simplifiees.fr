#export_template-edit.fr-my-4w
  .fr-mb-6w
    = render Dsfr::AlertComponent.new(state: :info, title: "Nouvel éditeur de modèle d'export", heading_level: 'h3') do |c|
      - c.with_body do
        Cette page permet d'éditer un modèle d'export tabulaire et ainsi sélectionner les champs que vous souhaitez exporter.
        Essayez-le et donnez-nous votre avis
        en nous envoyant un email à #{mail_to(CONTACT_EMAIL, subject: "Editeur de modèle d'export")}.
.fr-grid-row.fr-grid-row--gutters
  .fr-col-12.fr-col-md-8
    = form_with model: [:instructeur, @procedure, export_template], local: true do |f|


      = f.hidden_field "[dossier_folder][template]", value: export_template.dossier_folder.template_json
      = f.hidden_field "[export_pdf][template]", value: export_template.export_pdf.template_json

      = render Dsfr::InputComponent.new(form: f, attribute: :name, input_type: :text_field)

      - if groupe_instructeurs.many?
        .fr-input-group
          = f.label :groupe_instructeur_id, class: 'fr-label' do
            = f.object.class.human_attribute_name(:groupe_instructeur_id)
            = render EditableChamp::AsteriskMandatoryComponent.new
            %span.fr-hint-text
              Avec quel groupe instructeur souhaitez-vous partager ce modèle d'export ?
          = f.collection_select :groupe_instructeur_id, groupe_instructeurs, :id, :label, {}, class: 'fr-select'
      - else
        = f.hidden_field :groupe_instructeur_id

      %fieldset.fr-fieldset.fr-fieldset--inline
        %legend#radio-inline-legend.fr-fieldset__legend.fr-text--regular
          Format export
        .fr-fieldset__element.fr-fieldset__element--inline
          .fr-radio-group
            = f.radio_button :kind, "ods", id: "ods"
            %label.fr-label{ for: "ods" } ods
          .fr-radio-group
            = f.radio_button :kind, "xlsx", id: "xlsx"
            %label.fr-label{ for: "xlsx" } xlsx
          .fr-radio-group
            = f.radio_button :kind, "csv", id: "csv"
            %label.fr-label{ for: "csv" } csv

      = render partial: 'checkbox_group', locals: { title: 'Colonnes Usager', all_columns: @export_template.all_usager_columns, checked_columns: @export_template.columns }


      = render partial: 'checkbox_group', locals: { title: 'Colonnes Infos dossier', all_columns: @export_template.all_dossier_columns, checked_columns: @export_template.columns }

      = render partial: 'checkbox_group', locals: { title: 'Colonnes Formulaire', all_columns: @export_template.all_tdc_columns, checked_columns: @export_template.columns }

      - @export_template.all_repetable_tdc_columns.each do |repet|
        = render partial: 'checkbox_group', locals: { title: "Colonnes Formulaire #{repet[:libelle]}", all_columns: repet[:types_de_champ], checked_columns: @export_template.columns }


      .fixed-footer
        .fr-container
          %ul.fr-btns-group.fr-btns-group--inline-md
            %li
              = f.submit "Enregistrer", class: "fr-btn"
            %li
              = link_to "Annuler", instructeur_procedure_path(@procedure), class: "fr-btn fr-btn--secondary"
            - if @export_template.persisted?
              %li
                = link_to "Supprimer", [:instructeur, @procedure, @export_template], method: :delete, data: { confirm: "Voulez-vous vraiment supprimer ce modèle ? Il sera supprimé pour tous les instructeurs du groupe"}, class: "fr-btn fr-btn--secondary"
