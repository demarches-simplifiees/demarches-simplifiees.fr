= render partial: 'administrateurs/breadcrumbs',
  locals: { steps: [['DÃ©marches', admin_procedures_path],
                    [@procedure.libelle.truncate_words(10), admin_procedure_path(@procedure)],
                    ['Jetons API', [:admin, @procedure, :jetons]],
                    [t('.data_sources')]] }

.fr-container
  .fr-mb-3w
    = link_to "Liste des jetons",
      [:admin, @procedure, :jetons],
      class: "fr-link fr-icon-arrow-left-line fr-link--icon-left"

  %h1.fr-h2= t('.title')

= form_with model: @procedure, url: admin_procedure_api_particulier_sources_path, local: true, html: { class: 'form' } do |f|
  .fr-container#sources-particulier-form.mb-2
    = render Dsfr::AlertComponent.new(state: :info, size: :sm, extra_class_names: 'fr-mb-2w') do |c|
      - c.with_body do
        %p
          = t('.explication_html')

    - @available_sources.each do |provider_key, scopes|
      %h2.fr-h3= t("api_particulier.providers.#{provider_key}.libelle")

      - scopes.each do |scope_key, sources|
        %h3.fr-h4= t("api_particulier.providers.#{provider_key}.scopes.#{scope_key}.libelle")
        %ul.list-style-type-none.procedure-admin-api-particulier-sources{ id: "#{provider_key}-#{scope_key}" }
          - sources.each do |source_key, enabled_hash|
            - enabled = (@procedure.api_particulier_sources.dig(provider_key, scope_key)&.include?(source_key)).present?
            %li
              %label
                = check_box_tag "api_particulier_sources[#{provider_key}][#{scope_key}][]", "#{source_key}", enabled
                #{t("api_particulier.providers.#{provider_key}.scopes.#{scope_key}.#{source_key}")}

  = render Procedure::FixedFooterComponent.new(procedure: @procedure, form: f)
