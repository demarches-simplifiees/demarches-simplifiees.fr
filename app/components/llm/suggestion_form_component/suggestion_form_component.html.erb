<% if llm_rule_suggestion.state == 'completed' %>
  <h2 class="fr-h3 mt-4"><%= step_title %></h2>
  <%= render Dsfr::CalloutComponent.new(title: "Ã€ quoi sert cette rÃ¨gle ?", theme: :neutral) do |callout| %>
    <% callout.with_body do %>
      <p><%= step_summary %></p>
    <% end %>
  <% end %>
  <% if suggestions_count.zero? %>
    <%= render Dsfr::AlertComponent.new(state: :success) do |component| %>
      <% component.with_body do %>
        <p>
          ðŸŽ‰ <strong>FÃ©licitations</strong>, nous nâ€™avons aucune suggestion
          pertinente Ã  proposer sur ce thÃ¨me, ce qui signifie probablement que
          votre formulaire est dÃ©jÃ  de qualitÃ©!
        </p>

        <%= form_for llm_rule_suggestion,
                      url: accept_simplification_admin_procedure_types_de_champ_path(procedure, llm_rule_suggestion),
                      method: :post do |form| %>
          <p class="fr-mt-1w">
            <%= form.submit("Passer Ã  la suite", class: "fr-btn") %>
          </p>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <div class="border-background-contrast-grey fr-p-2w">
      <p class="fr-badge fr-badge--info">
        <%= suggestions_count %>
        <%= 'suggestion'.pluralize(suggestions_count) %>
      </p>

      <%= form_for llm_rule_suggestion,
                    url: accept_simplification_admin_procedure_types_de_champ_path(procedure, llm_rule_suggestion),
                    method: :post,
                    data: { controller: "enable-submit-if-checked" } do |form| %>
        <% ordered_llm_rule_suggestion_items.each do |llm_rule_suggestion_item| %>
          <%= form.fields_for :llm_rule_suggestion_items, llm_rule_suggestion_item do |ff| %>
            <%= render item_component.new(form_builder: ff) %>
          <% end %>
        <% end %>

        <ul class="fr-btns-group fr-btns-group--inline-md mt-4 flex justify-center">
          <li>
            <%= link_to("Annuler et revenir Ã  l'Ã©cran de gestion", back_link, class: "fr-btn fr-btn--secondary") %>
          </li>

          <li>
            <%= form.submit("Appliquer les suggestions et poursuivre", class: "fr-btn", data: { 'enable-submit-if-checked-target': 'submit' }, disabled: !at_least_one_accepted?) %>
          </li>
        </ul>
      <% end %>
    </div>
  <% end %>
<% else %>
  <div>
    <%= display_message %>

    <p><%= button %></p>
  </div>
<% end %>
