<% if llm_rule_suggestion.completed? %>
  <%= render Dsfr::CalloutComponent.new(title: t('.summary.title'), theme: :info) do |callout| %>
    <% callout.with_html_body do %>
      <%= t(".summary.#{rule}_html") %>
    <% end %>
  <% end %>
  <% if suggestions_count.zero? %>
    <%= render Dsfr::AlertComponent.new(state: :success) do |component| %>
      <% component.with_body do %>
        <p>
          üéâ <strong>F√©licitations</strong>, nous n‚Äôavons aucune suggestion
          pertinente √† proposer sur ce th√®me, ce qui signifie probablement que
          votre formulaire est d√©j√† de qualit√©!
        </p>

        <%= form_for llm_rule_suggestion,
                      url: accept_simplification_admin_procedure_types_de_champ_path(procedure, llm_rule_suggestion),
                      method: :post do |form| %>
          <p class="fr-mt-1w">
            <%= form.submit("Passer √† la suite", class: "fr-btn") %>
          </p>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <div class="border-background-contrast-grey fr-p-2w">
      <p class="fr-badge fr-badge--info fr-mb-3w">
        <%= suggestions_count %>
        <%= 'suggestion'.pluralize(suggestions_count) %>
      </p>

      <%= form_for llm_rule_suggestion,
                    url: accept_simplification_admin_procedure_types_de_champ_path(procedure, llm_rule_suggestion),
                    method: :post,
                    data: { controller: "enable-submit-if-checked" } do |form| %>
        <fieldset
          class="fr-fieldset"
          data-action="click->enable-submit-if-checked#click"
        >
          <% ordered_llm_rule_suggestion_items.each do |llm_rule_suggestion_item| %>
            <%= form.fields_for :llm_rule_suggestion_items, llm_rule_suggestion_item do |ff| %>
              <%= render item_component.new(form_builder: ff) %>
            <% end %>
          <% end %>
        </fieldset>

        <ul class="fr-btns-group fr-btns-group--inline-md mt-4 flex justify-center">
          <li>
            <% if last_rule? %>
              <%= link_to("Ignorer et revenir √† l‚Äô√©cran de gestion", back_link, class: "fr-btn fr-btn--secondary") %>
            <% else %>
              <%= form.submit("Ignorer et poursuivre", class: "fr-btn fr-btn--secondary") %>
            <% end %>
          </li>

          <li>
            <%= form.submit("Appliquer les suggestions et poursuivre", class: "fr-btn", data: { 'enable-submit-if-checked-target': 'submit' }, disabled: !at_least_one_accepted?) %>
          </li>
        </ul>
      <% end %>
    </div>
  <% end %>
<% elsif stepper_finished? %>
  <%= render Dsfr::AlertComponent.new(state: :success) do |component| %>
    <% component.with_body do %>
      <p>
        <strong>Ce parcours d‚Äôam√©lioration de la qualit√© du formulaire est termin√©.</strong>
        Vous pourrez obtenir de nouvelles suggestions une fois que vous aurez
        modifi√© le formulaire.
      </p>

      <p class="fr-mt-1w">
        <%= link_to("Revenir √† l‚Äô√©cran de gestion", back_link, class: "fr-btn") %>
      </p>
    <% end %>
  <% end %>
<% else %>
  <div
    data-controller="<%= poll_controller_data %>"
    data-turbo-poll-url-value="<%= poll_url if should_poll? %>"
    data-turbo-poll-interval-value="3000"
  >
    <%= display_message %>

    <% if llm_rule_suggestion.state.in?(['running', 'queued']) %>
      <span class="fr-btn fr-btn--tertiary llm-job-progress">
        <span class="llm-job-progress__bar"></span>
        <span class="llm-job-progress__label"><%= enqueue_button_text %></span>
      </span>
    <% else %>
      <p><%= button %></p>
    <% end %>
  </div>
<% end %>
